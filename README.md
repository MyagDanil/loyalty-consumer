Loyalty Consumer
Микросервис для обработки транзакций
Сервис читает события из Kafka, атомарно записывает их в PostgreSQL, обновляет баланс пользователя и кеширует его в Redis для быстрых чтений.

Основные возможности
Консьюмер Kafka (на Go, библиотека sarama) с поддержкой consumer groups и ручным управлением offset’ами.

Атомарная обработка транзакций в PostgreSQL (begin / commit / rollback) с использованием pgx/pgxpool.

Кеширование балансов пользователей в Redis для ускорения чтения и снижения нагрузки на базу.

Валидация входящих событий через go-playground/validator (enterprise-подход).

Логирование в формате JSON (logrus), удобное для интеграции с ELK / Loki.

Контейнеризация через Docker, возможность запуска всех зависимостей через Docker Compose.

Архитектура микросервиса: чёткое разделение слоёв (handler, store, cache, kafka, config).

Учитываются базовые правила безопасности: валидация входных данных, защита от типичных ошибок из OWASP TOP‑10, безопасная работа с конфигурацией через переменные окружения.

Архитектура
Сервис построен по микросервисному подходу и состоит из нескольких слоёв:

cmd/consumer – точка входа, инициализация конфигурации, логгера, подключений к PostgreSQL/Redis/Kafka, запуск консьюмера с graceful shutdown.

internal/handler – бизнес-логика обработки сообщений:

парсинг и валидация JSON-сообщений в структуру Transaction;

открытие транзакции в БД;

вставка записи транзакции и обновление баланса;

commit или rollback;

асинхронное обновление кеша в Redis.

internal/models – DTO/модели домена (например, Transaction) с валидацией через validator и JSON-тегами.

internal/store – слой доступа к данным PostgreSQL (insert/update/select, управление транзакциями).

internal/cache – обёртка над Redis для работы с кешем балансов.

internal/kafka – обёртка над Kafka Consumer Group (sarama), делегирующая обработку сообщений в handler.

internal/config – загрузка конфигурации из переменных окружения и настройка логгера.

Такой подход упрощает тестирование, сопровождение и масштабирование сервиса.

Технологии
Язык: Go (Golang)

Сообщения: Kafka (consumer group, offset management)

Хранение данных: PostgreSQL

Кеш: Redis

Контейнеризация: Docker / Docker Compose

Логирование: logrus (JSON-формат)

Валидация: go-playground/validator

Контроль версий: Git
